import express from "express";
import multer from "multer";
import {
  createBlog,
  getAllBlogs,
  getBlogBySlug,
  updateBlog,
  deleteBlog,
} from "../controllers/blogController.js";
import { protect, staffProtect } from "../middlewares/authMiddleware.js";

const router = express.Router();

// For image uploads
const storage = multer.memoryStorage();
const upload = multer({ storage });

// Public routes
router.get("/", getAllBlogs);       // Get all blogs
router.get("/:slug", getBlogBySlug); // Get blog by slug

// Admin / Staff routes
router.post("/", protect, staffProtect, upload.single("image"), createBlog);
router.put("/:id", protect, staffProtect, upload.single("image"), updateBlog);
router.delete("/:id", protect, staffProtect, deleteBlog);

export default router;
import express from "express";
import { protect, staffProtect } from "../middlewares/authMiddleware.js";
import {
  createComment,
  getCommentsByLocation,
  toggleLike,
  addReply,
  getAllComments,
  deleteComment,
  getCommentsForDistrict,
  deleteReply,
} from "../controllers/commentController.js";

const router = express.Router();

// =========================
// Public / User Routes
// =========================

// Add a comment
router.post("/", protect, createComment);

// Get comments for a location
router.get("/location/:locationId", getCommentsByLocation);

// Like / Unlike a comment
router.put("/like/:id", protect, toggleLike);

// Add a reply to a comment
router.post("/reply/:id", protect, addReply);
router.delete("/reply/:commentId/:replyId", protect, deleteReply);


router.get("/district/:id", getCommentsForDistrict);
// =========================
// staffProtect Routes
// =========================

// Get all comments (with optional districtId & locationId filters)
router.get("/", protect, staffProtect, getAllComments);

// Delete a comment
router.delete("/:id", protect, protect, deleteComment);


export default router;
import express from "express";
import { contactUs, sendOtp, verifyOtp } from "../controllers/contactController.js";

const router = express.Router();

router.post("/", contactUs);
router.post("/send-otp", sendOtp);
router.post("/verify-otp", verifyOtp);


export default router;import express from "express";
import {
  protect,
  adminProtect,
  staffProtect,
} from "../middlewares/authMiddleware.js";
import {
  createContribution,
  getContributionsByLocation,
  getContributionById,
  verifyContribution,
  getAllContributions,
  deleteContribution,
  getContributionsByUser,
  getContributionComments,
  addContributionComment,
  toggleContributionCommentLike,
  toggleContributionLike,
  getContributionsForDistrict,
  contributionCommentDelete,
} from "../controllers/contributionController.js";
import multer from "multer";

const router = express.Router();
const storage = multer.memoryStorage();
const upload = multer({ storage });

// Create a contribution (logged-in user)
router.post(
  "/",
  protect,
  upload.fields([
    { name: "images", maxCount: 10 },
    { name: "coverImage", maxCount: 1 },
  ]),
  createContribution
);

router.get("/user", protect, getContributionsByUser);

// Get all verified contributions for a location
router.get("/location/:locationId", getContributionsByLocation);

// Get single contribution
router.get("/:id", getContributionById);

// Admin verifies a contribution
router.put("/verify/:id", protect, staffProtect, verifyContribution);

// Comments on a contribution
router.get("/:id/comments", getContributionComments); // get all comments for a contribution
router.post("/:id/comments", protect, addContributionComment); // add comment to a contribution
router.put(
  "/:contribId/comments/like/:commentId",
  protect,
  toggleContributionCommentLike
); // like/unlike a comment
router.put("/:id/like", protect, toggleContributionLike); // like/unlike a contribution
router.get("/district/:id", getContributionsForDistrict);
router.delete(
  "/:contribId/comments/:commentId",
  protect,
  contributionCommentDelete
); // delete a commen

// âœ… Admin: Get all contributions
router.get("/", protect, staffProtect, getAllContributions);
router.delete("/:id", protect, staffProtect, deleteContribution);

export default router;
import express from "express";
import multer from "multer";
import {
  getAllDistricts,
  getDistrictById,
  createDistrict,
  addLocationToDistrict,
  updateDistrict,
  getNearestDistrict,
  getDistrictByState,
  getCommentsForDistrict, 
} from "../controllers/districtController.js";
import { protect, adminProtect } from "../middlewares/authMiddleware.js";

const router = express.Router();

// âœ… Use memory storage for S3 upload
const storage = multer.memoryStorage();
const upload = multer({ storage });

// ðŸŸ¢ Public routes
router.get("/", getAllDistricts);
router.get("/:id", getDistrictById);
router.get("/state/:state", getDistrictByState); 
router.get("/:id/comments", getCommentsForDistrict);

// âœ… Get nearest district by coordinates (Public)
router.get("/nearest/:lat/:lon", getNearestDistrict);

// ðŸ”’ Admin-only routes
router.post("/", protect, adminProtect, upload.single("image"), createDistrict);
router.put("/:id/location", protect, adminProtect, addLocationToDistrict);
router.put("/:id", protect, adminProtect, upload.single("image"), updateDistrict);

export default router;
import express from "express";
import multer from "multer";
import {
  getAllHotels,
  getHotelById,
  createHotel,
  updateHotel,
  deleteHotel,
  getNearestHotels,
} from "../controllers/hotelController.js";

import { protect, staffProtect } from "../middlewares/authMiddleware.js";

const storage = multer.memoryStorage();
const upload = multer({ storage });

const router = express.Router();

// Public routes
router.get("/", getAllHotels);
router.get("/:id", getHotelById);
router.get("/nearest/:locationId", getNearestHotels);

// Admin routes
router.post("/", protect, staffProtect, upload.array("images", 1), createHotel);
router.put("/:id", protect, staffProtect, upload.array("images", 1), updateHotel);
router.delete("/:id", protect, staffProtect, deleteHotel);

export default router;
import express from "express";
import multer from "multer";
import {
  getAllLocations,
  getLocationById,
  createLocation,
  updateLocation,
  deleteLocation,
  getAllLocationsNoDistrict,
  getNearestLocation,
} from "../controllers/locationController.js";
import { protect,staffProtect } from "../middlewares/authMiddleware.js";


const storage = multer.memoryStorage();
const upload = multer({ storage });

const router = express.Router();

// Public routes
router.get("/district/:district", getAllLocations);
router.get("/:id", getLocationById);
router.get("/nearest/:lat/:lon", getNearestLocation);
router.get("/", getAllLocationsNoDistrict);

// Admin only
router.post("/", protect, staffProtect,upload.array("images", 10), createLocation);
router.put("/:id", protect, staffProtect,upload.array("images", 10), updateLocation);
router.delete("/:id", protect, staffProtect, deleteLocation);

export default router;
import express from "express";
import { trackVisit, getStats, recordExit, getUserStats, getUserDetails, getLocationStats, getLocationDetails, getTopHotels, getHotelDetails, getHotelStats } from "../controllers/trackController.js";

const router = express.Router();

// Track a page visit
router.post("/", trackVisit);

// Optional: Analytics endpoint
router.get("/stats", getStats);


router.get("/user-stats", getUserStats);
router.get("/user-details/:userId", getUserDetails);
router.get("/location-stats", getLocationStats);
router.get("/location-details/:location", getLocationDetails);
router.get("/top-hotels",getTopHotels);
router.get("/hotel-details/:hotelId",getHotelDetails);
router.get("/hotel-stats",getHotelStats);

router.post("/exit", recordExit);

export default router;
import express from "express";
import multer from "multer";
import {
  registerUser,
  loginUser,
  getUserProfile,
  updateUserProfile,
  getOtherUserProfile,
  toggleFollow,
  addToWishlist,
  removeFromWishlist,
  trackLocationVisit,
  getAllUsers,
  updateUserRole,
  deleteUser,
  getWishlist,
  requestPasswordReset,
  verifyResetOTP,
  resetPassword,
} from "../controllers/userController.js";
import { protect,staffProtect } from "../middlewares/authMiddleware.js";

const router = express.Router();

// âœ… Setup multer to handle in-memory uploads
const storage = multer.memoryStorage();
const upload = multer({ storage });

// ---------------- AUTH ----------------
router.post("/register", registerUser);
router.post("/login", loginUser);

// ---------------- PROFILE ----------------
router.get("/profile", protect, getUserProfile);

// âœ… Allow updating profile info + image uploads
router.put("/profile",protect,upload.fields([
    { name: "profilePic", maxCount: 1 },
    { name: "coverPhoto", maxCount: 1 },
  ]),updateUserProfile
);

// ---------------- OTHER USERS ----------------
router.get("/profile/:username", protect, getOtherUserProfile);

// ---------------- FOLLOW ----------------
router.put("/follow/:username", protect, toggleFollow);

// ---------------- WISHLIST ----------------
router.put("/wishlist/add/:locationId", protect, addToWishlist);
router.put("/wishlist/remove/:locationId", protect, removeFromWishlist);
router.get("/wishlist", protect, getWishlist);

// ---------------- TRACK LOCATION VISITS ----------------
// Handles both logged-in and anonymous users
router.put("/locations/track/:locationId", trackLocationVisit);

// Admin routes
router.get("/admin/users", protect, staffProtect, getAllUsers);
router.put("/admin/users/:id/role", protect, staffProtect, updateUserRole);
router.delete("/admin/users/:id", protect, staffProtect, deleteUser);

//forget password route

// POST: Request reset link
router.post("/forgot-password", requestPasswordReset);

// POST: Verify OTP
router.post("/verify-otp", verifyResetOTP);

// POST: Reset password
router.post("/reset-password", resetPassword);

export default router;
